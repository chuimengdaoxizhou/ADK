# LinkedIn 推文生成器循环代理

本示例展示了如何在 Agent Development Kit (ADK) 中使用 **顺序代理**和**循环代理**模式来生成和优化 LinkedIn 推文。

---

## 概述

LinkedIn 推文生成器采用带有循环组件的顺序工作流，执行以下任务：

1. 生成初始 LinkedIn 推文
2. 反复优化该推文，直到满足质量要求

这个示例展示了以下关键模式：

1. **顺序工作流**：由多个阶段组成的线性流程
2. **迭代优化**：使用循环机制反复改进内容
3. **自动质量检查**：根据特定标准验证内容质量
4. **基于反馈的优化**：根据反馈提升内容质量
5. **循环退出工具**：当质量达标时退出循环

---

## 架构

系统由以下组件组成：

### 根顺序代理

* `LinkedInPostGenerationPipeline`：顺序代理，用于协调整个流程：

  1. 首先调用初始内容生成器生成第一版推文
  2. 然后进入内容优化循环

### 初始内容生成器

* `InitialPostGenerator`：一个 LLM 代理，负责在没有上下文的情况下生成第一版推文

### 内容优化循环

* `PostRefinementLoop`：循环代理，执行两阶段优化流程：

  1. 调用审阅器评估推文质量并决定是否退出循环
  2. 如果继续循环，则调用优化器改进内容

### 循环内的子代理

1. **Post Reviewer（审阅器）**：

   * 检查推文是否符合质量标准
   * 提供改进反馈，或调用退出工具终止循环

2. **Post Refiner（优化器）**：

   * 根据反馈对推文进行优化提升

### 工具（Tools）

1. **字符计数器**：检查推文是否符合长度限制（供审阅器使用）
2. **退出循环（Exit Loop）**：当质量达标时由审阅器调用，退出循环流程

---

## 使用退出工具控制循环

本示例中的关键设计模式之一是使用 `exit_loop` 工具控制循环终止。

审阅器的职责包括：

1. **质量评估**：检查当前推文是否符合所有标准
2. **循环控制**：当符合标准时调用 `exit_loop` 工具

`exit_loop` 工具的作用是：

* 设置 `tool_context.actions.escalate = True`
* 向 `LoopAgent` 发出信号终止当前循环

此设计遵循 ADK 最佳实践：

* 初始生成与优化分离
* 审阅器负责判断是否退出循环
* 优化过程由专门的代理完成
* 循环控制通过工具机制显式管理

---

## 使用方法

运行此示例：

```bash
cd 11-loop-agent
adk web
```

然后在 Web 界面中输入如下提示：

> 生成一条关于我从 @aiwithbrandon 的 Agent Development Kit 教程中学到了什么的 LinkedIn 推文。

系统将自动执行以下流程：

1. 生成第一版推文
2. 审查推文内容是否达标
3. 若符合要求，调用 `exit_loop` 退出循环
4. 否则，提供反馈并进行优化
5. 继续此过程直到满足条件或达到最大迭代次数（10）
6. 返回最终推文

---

## 示例输入

```
生成一条关于我从 @aiwithbrandon 的 Agent Development Kit 教程中学到了什么的 LinkedIn 推文。
```

---

## 循环终止条件

循环将通过以下两种方式之一终止：

1. 当推文满足所有质量要求时（审阅器调用 `exit_loop` 工具）
2. 达到最大迭代次数（默认为 10 次）

---

如需深入了解，请参考：

* [ADK 循环代理官方文档](https://google.github.io/adk-docs/agents/workflow-agents/loop-agents)
